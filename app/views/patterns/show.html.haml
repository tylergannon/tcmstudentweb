- title my_title(@pattern)

%h2 Signs and Symptoms
Keys: #{@pattern.pattern_symptoms.select{|x| x.key_symptom}.map{|y| y.symptom_name}.join(", ")}

%ul#pattern_symptoms
  - @pattern.pattern_symptoms.each do |s|
    - l = link_to s.symptom_name, s.symptom
    = content_tag_for :li, s do
      - if can? :update, @pattern
        %span.handle [drag]
      - if s.maybe
        (possibly)
      - if s.key_symptom
        %i= l
      - else
        = l
      - unless s.commentary.blank?
        %ul
          %li
            :tcmtextile
              #{s.commentary}

%h3 Primary Pattern
!= tag_list @pattern.primary_patterns
%br/

- if can? :update, @pattern
  = sortable_element "pattern_symptoms", :url => sort_pattern_symptoms_path

%h2 Treatment Principles
%ul
  - @pattern.pattern_treatment_principles.each do |p|
    %li
      = p.treatment_principle_name
      - unless p.commentary.blank?
        %ul
          %li
            :tcmtextile
              #{p.commentary}

- unless @pattern.commentary.blank?
  %h2 Commentary
  :tcmtextile
    #{@pattern.commentary}

- unless @pattern.pattern_formulas.blank?
  %h2 Formulas
  %ul
    - @pattern.pattern_formulas.each do |pf|
      %li!= "#{link_to pf.formula_pinyin, pf.formula} (#{pf.citation.textbook.title if pf.citation})"

- unless @pattern.point_prescriptions.blank?
  - @pattern.point_prescriptions.each do |pp|
    %h2!= "Point Prescription: #{pp.citation.textbook_title if pp.citation} #{link_to "edit", edit_point_prescription_path(pp)}"
    %ul
      - pp.pp_acu_points.order(:acu_point_id).each do |ap|
        %li
          :tcmtextile
            #{link_to ap.acu_point_abbrev, ap.acu_point} (#{ap.commentary})

%h3 Tags
!= tag_list @pattern.tags
%br/
%h3 Disease
!= tag_list @pattern.diseases
%br/
%h3 Primary Pattern
!= tag_list @pattern.primary_patterns
%br/

- if can? :update, @pattern
  = link_to 'Edit', edit_pattern_path(@pattern)

